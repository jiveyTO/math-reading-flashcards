<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Grade 1 Math & Reading Flashcards</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            display: flex;
            justify-content: center;
            align-items: center;
            height: 100vh;
            background-color: #f2f2f2;
        }
        .card {
            background-color: #fff;
            padding: 2em;
            border-radius: 10px;
            box-shadow: 0 4px 8px rgba(0,0,0,0.1);
            text-align: center;
            position: relative;
        }
        .question {
            font-size: 1.5em;
            margin-bottom: 1em;
        }
        button {
            padding: 0.5em 1em;
            font-size: 1em;
            margin-top: 1em;
            cursor: pointer;
        }
    </style>
</head>
<body>

<div class="card">
    <div id="questionCard">
        <div class="question" id="question">Loading...</div>
        <button id="rightButton" style="background-color: #4CAF50; color: white; margin-right: 1em;">Right</button>
        <button id="wrongButton" style="background-color: #f44336; color: white;">Wrong</button>
        <button id="restartButton" style="display: none; background-color: #2196F3; color: white; margin-top: 1em;">Restart</button>
    </div>

    <div id="prizeCard">
        <div style="font-size: 1.5em;">ðŸŽ‰ Congrats! You got 10 right! ðŸŽ‰</div>
        <div>
            <img src="images/minecraft_prize_pickaxe.png" alt="Pickaxe Prize" style="width: 80px; height: 80px; margin-top: 15px;">
        </div>
        <button id="continueButton" style="background-color: #4CAF50; color: white;">Continue</button>
    </div>
    
    <div style="margin-top: 1em; text-align: center;">
        <div id="score" style="font-size: 1em;">Score: 0</div>
        <div id="cardStats" style="height: 24px; margin-top: 4px;"></div>
    </div>    
</div>

<script>
    const savedStats = localStorage.getItem('flashcardStats');
    const stats = savedStats ? JSON.parse(savedStats) : {};
    let currentQuestion = null;


    function renderMinecraftRating(pct) {
        const container = document.getElementById('cardStats');
        container.style.display = 'flex';
        container.style.justifyContent = 'center';
        container.innerHTML = '';

        const barWidth = 100; // Width of the bar in px
        const sliderWidth = 4; // Width of the slider in px

        const bar = document.createElement('div');
        bar.style.width = `${barWidth}px`;
        bar.style.height = '12px';
        bar.style.background = 'linear-gradient(to right, orange, yellow, #0080FF, #00FF00)';
        bar.style.position = 'relative';
        bar.style.borderRadius = '6px'; // Rounded corners
        container.appendChild(bar);

        const slider = document.createElement('div');
        slider.style.width = `${sliderWidth}px`;
        slider.style.height = '16px';
        slider.style.backgroundColor = 'black';
        slider.style.left = `${(pct / 100) * barWidth - sliderWidth / 2}px`;
        slider.style.top = '-2px'; // To align with bar
        slider.style.position = 'absolute';
        bar.appendChild(slider);
    }

    fetch('questions.json')

        .then(response => response.json())
        .then(data => {
            const questions = data.questions;
            questions.forEach(q => {
                if (!stats[q]) {
                    stats[q] = { right: 0, shown: 0 };
                }
            });
            let score = 0;
            let prizeCounter = 0;

            function nextQuestion() {
                if (questions.length > 0) {
                    if (prizeCounter >= 10) {
                        document.getElementById('question').style.display = 'none';
                        document.getElementById('cardStats').style.display = 'none';
                        document.getElementById('rightButton').style.display = 'none';
                        document.getElementById('wrongButton').style.display = 'none';
                        document.getElementById('prizeCard').style.display = 'block';
                        prizeCounter = 0;
                        return;
                    }
                    // Allow questions with <50% right to appear again
                    const eligible = [...questions];
                    Object.entries(stats).forEach(([q, s]) => {                        
                        const pct = s.shown > 0 ? s.right / s.shown : 1;
                        if (pct < 0.5 && !questions.includes(q)) {
                            eligible.push(q); // retry if under 50% and already shown
                        }
                    });

                    const randomIndex = Math.floor(Math.random() * eligible.length);
                    const question = eligible[randomIndex];

                    // Remove from the original questions array if it's still there
                    const indexInQuestions = questions.indexOf(question);
                    if (indexInQuestions !== -1) {
                        questions.splice(indexInQuestions, 1);
                    }

                    document.getElementById('question').innerText = question;
                    const s = stats[question];
                    const pct = s.shown > 0 ? Math.round((s.right / s.shown) * 100) : 0;
                    renderMinecraftRating(pct);
                    stats[question].shown++;
                    localStorage.setItem('flashcardStats', JSON.stringify(stats));
                    currentQuestion = question;
                } else {
                    document.getElementById('question').innerText = 'Great job! You finished!';
                    document.getElementById('cardStats').innerText = '';
                    document.getElementById('rightButton').style.display = 'none';
                    document.getElementById('wrongButton').style.display = 'none';
                    document.getElementById('restartButton').style.display = 'inline-block';
                    console.table(stats);
                }
            }

            // Make it globally accessible to the button
            window.nextQuestion = nextQuestion;

            document.getElementById('rightButton').addEventListener('click', () => {
                if (currentQuestion) {
                    stats[currentQuestion].right++;
                    localStorage.setItem('flashcardStats', JSON.stringify(stats));
                    score++;
                    prizeCounter++;
                    console.log(`Prize Counter: ${prizeCounter}`);
                    document.getElementById('score').innerText = `Score: ${score}`;
                }
                nextQuestion();
            });

            document.getElementById('wrongButton').addEventListener('click', () => {
                nextQuestion();
            });
            document.getElementById('restartButton').addEventListener('click', () => {
                location.reload();
            });

            document.getElementById('continueButton').addEventListener('click', () => {
                document.getElementById('prizeCard').style.display = 'none';
                document.getElementById('question').style.display = 'block';
                document.getElementById('cardStats').style.display = 'block';
                document.getElementById('rightButton').style.display = 'inline-block';
                document.getElementById('wrongButton').style.display = 'inline-block';
                nextQuestion();
            });

            // Ensure prize card is hidden on load
            document.getElementById('prizeCard').style.display = 'none';
            // Load the first question
            nextQuestion();
        })
        .catch(error => {
            console.error('Error loading questions:', error);
            document.getElementById('question').innerText = 'Error loading questions.';
        });
</script>

</body>
</html>
